<!DOCTYPE html>
<html>
<head>
	<title>color plot</title>
	<style type="text/css">
		canvas{outline: 1px solid blue;}
	</style>
</head>
<body>

<script type="x-shader/x-vertex" id="vertexshader">

uniform float state;

attribute vec3 custompositiona;
attribute vec3 custompositionb;

attribute vec4 c;
varying vec4 vc;

void main() {
  vc = c;
  gl_Position = projectionMatrix *
                modelViewMatrix *
                vec4(position * (custompositiona+(state*(custompositionb - custompositiona))),1.0);
}
</script>
<script type="x-shader/x-fragment" id="fragmentshader">
varying vec4 vc;

void main() {
	gl_FragColor = vec4(vc);
}
</script>

<script type="text/javascript" src="/three.js/three.js"></script>
<script type="text/javascript" src="/tweenjs/build/tween.min.js"></script>
<script type="text/javascript">

// particles
attributes = {
	c:{
		type: 'c', 
		value: []
	},
	// r:{
	// 	type: 'f', 
	// 	value: []
	// },
	prgb:{
		type:'v3',
		value: []
	},

	custompositiona: { type: 'v3', value: [] },
	custompositionb: { type: 'v3', value: [] },

	// displacement: {	type: 'v3', value: [] },
};

uniforms = {
	// state: 0.0
	state: { type: "f", value: 0.0 },
};

var shaderMaterial = new THREE.ShaderMaterial( {

	uniforms: 		uniforms,
	attributes:     attributes,
	vertexShader:   document.getElementById( 'vertexshader' ).textContent,
	fragmentShader: document.getElementById( 'fragmentshader' ).textContent,

	blending: 		THREE.NormalBlending,
	depthTest: 		true,
	transparent:	false,
	
});


		// container = document.getElementById( 'container' );
var width = 960;//window.innerWidth;
var height = 540;//window.innerHeight;

var renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(width, height);
renderer.setClearColor(0xffffff, 1);
document.body.appendChild(renderer.domElement);


scene = new THREE.Scene();

camera = new THREE.PerspectiveCamera( 45, width / height, 1, 1000000 );
camera.position.z = 1000;

renderer.render(scene, camera);

function start(data){

	var radius = 200;
	var geometry = new THREE.Geometry();

	// debugger
	for (var x = 0; x < data.width; x++){
		for (var y = 0; y < data.height; y++){

			var i = (x + (y*data.width)) * 4;
			// var d = data[i];

			// var vertex = new THREE.Vector3();
			// vertex.x = x - (data.width/2);
			// vertex.y = y - (data.height/2);

			// vertex.x/=2;
			// vertex.y/=2;
			// vertex.z = Math.random() * 200 - 100;
			// vertex.z = 0;
			// vertex.x = data.data[i];
			// vertex.y = data.data[i+1] - 127;
			// vertex.z = 0;//data.data[i+2] - 127;
			// vertex.multiplyScalar( radius );

			// vertex.x = Math.random() * 200 - 100;
			// vertex.y = Math.random() * 200 - 100;


			// vertex.x = vertex.y = vertex.z = 1;

			geometry.vertices.push( new THREE.Vector3(1,1,1) );


			// var vertex_rgb = new THREE.Vector3(100,200,300);
			// vertex_rgb.x = data.data[i  ] - 127;
			// vertex_rgb.y = data.data[i+1] - 127;
			// vertex_rgb.z = data.data[i+2] - 127;
			// attributes.prgb.value.push(vertex)

			// attributes.r.value.push(250)


			attributes.custompositiona.value.push(new THREE.Vector3(x - (data.width/2),(data.height/2)-y,0))
			// attributes.custompositionb.value.push(new THREE.Vector3(x - (data.width/2),y - (data.height/2),0))

			// attributes.custompositionb.value.push(new THREE.Vector3(Math.random()*300,Math.random()*300,Math.random()*300))

			attributes.custompositionb.value.push(new THREE.Vector3(data.data[i]-127,data.data[i+1]-127,data.data[i+2]-127));

			// attributes.c.value.push(new THREE.Color(Math.random(),Math.random(),Math.random()));
			// attributes.c.value.push(new THREE.Color(0,0,0));
			attributes.c.value.push(new THREE.Color(data.data[i]/255,data.data[i+1]/255,data.data[i+2]/255));


		}
	}

	// var displacement = attributes.displacement.value;

	// for( var v = 0; v < geometry.vertices.length; v ++ ) {

	// 	displacement[ v ] = new THREE.Vector3( Math.random()*20, Math.random()*20, Math.random()*20 );

	// }

	// debugger;
	// for ( var i = 0; i < 1000; i ++ ) {

	// 	var vertex = new THREE.Vector3();
	// 	vertex.x = Math.random() * 200 - 100;
	// 	vertex.y = Math.random() * 200 - 100;
	// 	vertex.z = Math.random() * 200 - 100;
	// 	vertex.z = 0;
	// 	vertex.multiplyScalar( radius );

	// 	geometry.vertices.push( vertex );

	// 	attributes.c.value.push(new THREE.Color( 0xffffff*Math.random() ));

	// }

	particles = new THREE.ParticleSystem( geometry, shaderMaterial );

	scene.add(particles)




  var group = new THREE.Object3D();

	function ball(color){
		var r = (color & 0xff0000) >> 16,
		    g = (color & 0x00ff00) >> 8,
		    b = (color & 0x0000ff);


		var geometry2 = new THREE.SphereGeometry(10,10,10)
		var material = new THREE.MeshBasicMaterial( { wireframe: false, color: color, opacity: 0.2} );
		var sphere = new THREE.Mesh( geometry2, material );
		sphere.position.x = (r - 127);
		sphere.position.y = (g - 127);
		sphere.position.z = (b - 127);
		group.add( sphere );
	}


  ball(0x000000);

  ball(0x0000ff);
  ball(0x00ff00);
  ball(0xff0000);



  var material = new THREE.LineBasicMaterial({
      color: 0x888888,
      linewidth: 1
  });

  var geometry = new THREE.Geometry();

  var c_x, c_y, c_z;
  c_x = c_y = c_z = -127;

  geometry.vertices.push(new THREE.Vector3(c_x,c_y,c_z));
  geometry.vertices.push(new THREE.Vector3(c_x+255,c_y,c_z));
  
  geometry.vertices.push(new THREE.Vector3(c_x,c_y,c_z));
  geometry.vertices.push(new THREE.Vector3(c_x,c_y+255,c_z));
  
  geometry.vertices.push(new THREE.Vector3(c_x,c_y,c_z));
  geometry.vertices.push(new THREE.Vector3(c_x,c_y,c_z+255));


   var line = new THREE.Line(geometry, material);
   group.add(line);

   scene.add(group)



	function render() {
	  requestAnimationFrame(render);

	  particles.rotation.y += 0.002;

	  group.rotation.y = particles.rotation.y

	  renderer.render(scene, camera);
	  TWEEN.update();
	}

	render()

}

var img = new Image;
img.onload = function(){
	var c = document.createElement('canvas');
	c.width = 200;//img.width;
	c.height = 200;//img.height;

	// c.width = img.width;
	// c.height = img.height;

	var ctx = c.getContext('2d');
	ctx.drawImage(img,0,0);

	//document.body.appendChild(c)

	var data = ctx.getImageData(0,0,c.width,c.height);

	// debugger;

	// console.log(img.width)

	start(data);
}
img.src='img/example-3.png'


var x = {};

function flip(){
	var tween = new TWEEN.Tween(uniforms.state)
		.to({value: 1}, 5000)
		.easing(TWEEN.Easing.Exponential.InOut)
		// .delay(200)
		.onComplete(flop);
	tween.start();
}

function flop(){
	var tween = new TWEEN.Tween(uniforms.state)
		.to({value: 0}, 5000)
		.easing(TWEEN.Easing.Exponential.InOut)
		// .delay(200)
		.onComplete(flip);
	tween.start();

}

flip();

	</script>
</body>
</html>